<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bond Builders</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      margin: 0;
      padding: 1.5rem;
      background: #0e0f16;
      color: #f1f5ff;
      line-height: 1.6;
    }

    .app-shell {
      max-width: 800px;
      margin: 0 auto;
      border: 2px solid #5ddcff;
      border-radius: 16px;
      padding: 1.5rem;
      background: #111426;
      box-shadow: 0 0 25px rgba(93, 220, 255, 0.25);
    }

    h1 {
      margin-top: 0;
      text-align: center;
      letter-spacing: 0.08em;
    }

    .scoreboard {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      border: 1px solid #2f3b66;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      margin-bottom: 1rem;
      background: #141a33;
    }

    .section-heading {
      text-transform: uppercase;
      letter-spacing: 0.2em;
      font-size: 0.85rem;
      color: #9fd9ff;
      margin: 0 0 0.75rem;
      display: inline-block;
      padding-bottom: 0.3rem;
      border-bottom: 1px solid #1f2742;
    }

    .prompt-card {
      border: 1px solid #4c6fff;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      background: #101634;
    }

    .prompt-card p {
      margin: 0.25rem 0;
      color: #f1f5ff;
    }

    .prompt-card .mission-focus {
      font-style: italic;
      opacity: 0.9;
      color: #f1f5ff;
    }

    .elements {
      border: 1px solid #26304f;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      background: #0d1329;
    }

    .elements h2 {
      margin-top: 0;
    }

    .element-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.75rem;
    }

    .element-card {
      border: 1px solid #26304f;
      border-radius: 12px;
      padding: 0.75rem;
      text-align: left;
      background: #0c142d;
      color: inherit;
      font: inherit;
      cursor: pointer;
      transition: border-color 0.2s ease, transform 0.1s ease;
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    .element-card:hover,
    .element-card:focus-visible {
      border-color: #5ddcff;
      outline: none;
      transform: translateY(-2px);
    }

    .element-card.selected {
      border-color: #65ffbf;
      background: #102036;
      box-shadow: 0 0 12px rgba(101, 255, 191, 0.2);
    }

    .element-emoji {
      font-size: 1.8rem;
    }

    .element-name {
      font-weight: 600;
    }

    .element-detail {
      font-size: 0.9rem;
      color: #c6d2ff;
    }

    .selection-hint {
      margin-top: 0.75rem;
      font-style: italic;
      color: #c4ddff;
    }

    form {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }

    form label {
      width: 100%;
      font-weight: 600;
    }

    input[type="text"] {
      flex: 1;
      min-width: 200px;
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid #4c6fff;
      background: #0b1021;
      color: inherit;
      font-size: 1rem;
    }

    button {
      border: none;
      border-radius: 8px;
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
      background: linear-gradient(120deg, #36d1dc, #5b86e5);
      color: #05060c;
      font-weight: bold;
    }

    button.secondary {
      background: transparent;
      border: 1px solid #5ddcff;
      color: #5ddcff;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .feedback {
      border-radius: 12px;
      padding: 1rem;
      border: 1px solid #32557f;
      background: #0f172e;
      min-height: 96px;
    }

    .feedback .section-heading {
    .feedback h3 {
      margin-top: 0;
    }

    .mission-log {
      margin-top: 1.5rem;
      border: 1px solid #1f2742;
      border-radius: 12px;
      padding: 1rem;
      background: #0c1023;
    }

    .mission-log h2 {
      margin-top: 0;
    }

    .mission-log ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.75rem;
    }

    .mission-log li {
      border-left: 4px solid #36d1dc;
      padding-left: 0.75rem;
    }

    .celebrate {
      color: #65ffbf;
    }

    .hint {
      color: #f7d794;
    }

    @media (max-width: 600px) {
      body {
        padding: 1rem;
      }

      .app-shell {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <main class="app-shell">
    <h1>Bond Builders</h1>
    <section class="scoreboard">
      <div><strong>Round:</strong> <span id="round">1</span></div>
      <div><strong>Score:</strong> <span id="score">0</span> pts</div>
      <div><strong>Attempts this round:</strong> <span id="attempts">0</span></div>
    </section>

    <section class="prompt-card">
      <h2 class="section-heading">Materials Mission</h2>
      <p id="prompt">Loading challengeâ€¦</p>
      <p id="challenge-focus" class="mission-focus"></p>
    </section>

    <section class="elements">
      <h2 class="section-heading">Element Bench</h2>
      <p class="hint">Materials Mission:</p>
      <p id="prompt">Loading challengeâ€¦</p>
      <p id="challenge-focus" class="hint"></p>
    </section>

    <section class="elements">
      <h2>Element Bench</h2>
      <p>Tap two element tiles with the emojis that call to you (or type numbers like <code>1+2</code>).</p>
      <div id="element-grid" class="element-grid"></div>
      <p id="selected-elements" class="selection-hint">No elements selected yet.</p>
    </section>

    <form id="combo-form">
      <label for="combo-input">Your combination:</label>
      <input id="combo-input" type="text" autocomplete="off" placeholder="e.g., 1 + 2" />
      <button type="submit">Test Bond</button>
      <button type="button" id="next-round" class="secondary" disabled>Next Challenge</button>
      <button type="button" id="restart" class="secondary">Restart</button>
    </form>

    <section class="feedback" id="feedback">
      <h2 class="section-heading">Feedback</h2>
      <div id="feedback-body">
        <p>Choose elements to begin experimenting.</p>
      </div>
    </section>

    <section class="mission-log" aria-live="polite">
      <h2 class="section-heading">Mission Log</h2>
      <h3>Feedback</h3>
      <p>Choose elements to begin experimenting.</p>
    </section>

    <section class="mission-log" aria-live="polite">
      <h2>Mission Log</h2>
      <p id="mission-log-empty">Win rounds to record your breakthroughs.</p>
      <ul id="mission-log-list" hidden></ul>
    </section>
  </main>

  <script>
    const elements = [
      { id: "H", name: "Hydrogen", symbol: "H", atomicNumber: 1, property: "light, flammable gas", emoji: "ðŸ’§" },
      { id: "O", name: "Oxygen", symbol: "O", atomicNumber: 8, property: "supports combustion", emoji: "ðŸŒ¬ï¸" },
      { id: "C", name: "Carbon", symbol: "C", atomicNumber: 6, property: "forms strong bonds", emoji: "ðŸ§±" },
      { id: "N", name: "Nitrogen", symbol: "N", atomicNumber: 7, property: "fertilizer-building gas", emoji: "ðŸŒ±" },
      { id: "Na", name: "Sodium", symbol: "Na", atomicNumber: 11, property: "soft, reactive metal", emoji: "âš¡" },
      { id: "Cl", name: "Chlorine", symbol: "Cl", atomicNumber: 17, property: "forms salts quickly", emoji: "ðŸ§‚" },
      { id: "Fe", name: "Iron", symbol: "Fe", atomicNumber: 26, property: "strong structural metal", emoji: "ðŸ—ï¸" },
      { id: "Si", name: "Silicon", symbol: "Si", atomicNumber: 14, property: "semiconductor", emoji: "ðŸ”¦" },
      { id: "Cu", name: "Copper", symbol: "Cu", atomicNumber: 29, property: "great electrical conductor", emoji: "ðŸ”Œ" },
      { id: "S", name: "Sulfur", symbol: "S", atomicNumber: 16, property: "smells like matches", emoji: "ðŸ”¥" },
      { id: "He", name: "Helium", symbol: "He", atomicNumber: 2, property: "lighter-than-air gas", emoji: "ðŸŽˆ" },
      { id: "Ne", name: "Neon", symbol: "Ne", atomicNumber: 10, property: "glows in signs", emoji: "ðŸŽ‡" }
    ];

    const knownCompounds = {
      "C,O": {
        name: "Carbon Dioxide",
        formula: "COâ‚‚",
        funFact: "COâ‚‚ keeps greenhouse plants thriving in controlled environments."
      },
      "Fe,C": {
        name: "Steel",
        formula: "Fe+C",
        funFact: "Steel mixes iron with carbon to build skyscrapers and bridges."
      },
      "H,N": {
        name: "Ammonia",
        formula: "NHâ‚ƒ",
        funFact: "Ammonia stores nitrogen that fuels fertilizers and fuel cells."
      },
      "H,O": {
        name: "Water",
        formula: "Hâ‚‚O",
        funFact: "Water dissolves and transports ions in batteries and living cells."
      },
      "Na,Cl": {
        name: "Sodium Chloride",
        formula: "NaCl",
        funFact: "Road crews spread NaCl brine to melt ice before storms."
      },
      "Si,O": {
        name: "Silicon Dioxide",
        formula: "SiOâ‚‚",
        funFact: "SiOâ‚‚ becomes glass fiber that guides internet light signals."
      },
      "Cu,S": {
        name: "Copper Sulfide",
        formula: "CuS",
        funFact: "Copper sulfide shows up in solar cells that harvest sunlight."
      }
    };

    const challenges = [
      {
        id: "water",
        prompt: "Create the compound that keeps astronauts hydrated during long missions.",
        focus: "Think about life-support materials and universal solvents.",
        requiredElements: ["H", "O"],
        success: "You built waterâ€”mission control applauds your life-support skills!"
      },
      {
        id: "salt",
        prompt: "Whip up the de-icing compound that street crews spray before a snowstorm.",
        focus: "Look for a metal + halogen pair that forms a crystal lattice.",
        requiredElements: ["Na", "Cl"],
        success: "Salty success! Those roads will stay safe for commuters."
      },
      {
        id: "ammonia",
        prompt: "Combine elements that farmers use to boost plant growth and rocket engineers use in fuel.",
        focus: "One gas is super common in air, the other is the lightest element.",
        requiredElements: ["N", "H"],
        success: "Ammonia securedâ€”fertilizer factories and fuel depots cheer."
      },
      {
        id: "steel",
        prompt: "Forge the alloy backbone found inside bridges and skyscrapers.",
        focus: "Blend a structural metal with the element that loves forming chains.",
        requiredElements: ["Fe", "C"],
        success: "Steel strength achieved! Your virtual bridge is rock solid."
      },
      {
        id: "silica",
        prompt: "Build the glassy compound etched into every phone screen and fiber-optic cable.",
        focus: "Pair a semiconductor with the gas that helps fires burn brighter.",
        requiredElements: ["Si", "O"],
        success: "Sparkling silica! Data can zoom through those glass fibers."
      }
    ];

    const careerSparks = [
      "Materials scientists tweak alloys so skyscrapers sway safely in the wind.",
      "Battery engineers mix precise compounds so electric cars can sprint farther.",
      "Semiconductor designers pattern silicon wafers that route billions of signals.",
      "Ceramic specialists fuse silica-based glass that protects spacecraft windows.",
      "Chemical engineers refine fertilizers so crops grow with less water.",
      "Metallurgists combine iron and carbon to form steel cables for suspension bridges."
    ];

    const state = {
      round: 0,
      score: 0,
      attempts: 0,
      currentChallenge: null,
      displayedElements: [],
      missionLog: [],
      selectedIndices: []
    };

    const promptEl = document.getElementById("prompt");
    const focusEl = document.getElementById("challenge-focus");
    const roundEl = document.getElementById("round");
    const scoreEl = document.getElementById("score");
    const attemptsEl = document.getElementById("attempts");
    const elementGridEl = document.getElementById("element-grid");
    const selectedElementsEl = document.getElementById("selected-elements");
    const feedbackBody = document.getElementById("feedback-body");
    const feedbackEl = document.getElementById("feedback");
    const missionLogList = document.getElementById("mission-log-list");
    const missionLogEmpty = document.getElementById("mission-log-empty");
    const comboForm = document.getElementById("combo-form");
    const comboInput = document.getElementById("combo-input");
    const nextButton = document.getElementById("next-round");
    const restartButton = document.getElementById("restart");

    function shuffle(list) {
      const arr = [...list];
      for (let i = arr.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function generateElementSet(requiredIds) {
      const required = elements.filter((el) => requiredIds.includes(el.id));
      const remaining = shuffle(elements.filter((el) => !requiredIds.includes(el.id)));
      const set = [...required];
      while (set.length < 5 && remaining.length) {
        set.push(remaining.pop());
      }
      return shuffle(set);
    }

    function chooseChallenge() {
      if (!state.remainingChallenges || state.remainingChallenges.length === 0) {
        state.remainingChallenges = shuffle(challenges);
      }
      return state.remainingChallenges.pop();
    }

    function startRound() {
      state.round += 1;
      state.attempts = 0;
      state.currentChallenge = chooseChallenge();
      state.displayedElements = generateElementSet(state.currentChallenge.requiredElements);
      state.selectedIndices = [];
      updateUIForRound();
      comboInput.value = "";
      feedbackBody.innerHTML = "<p>Pick two elements to tackle the mission.</p>";
      feedbackEl.innerHTML = "<h3>Feedback</h3><p>Pick two elements to tackle the mission.</p>";
      comboInput.focus();
      nextButton.disabled = true;
    }

    function renderMissionLog() {
      if (!state.missionLog.length) {
        missionLogEmpty.hidden = false;
        missionLogList.hidden = true;
        missionLogList.innerHTML = "";
        return;
      }

      missionLogEmpty.hidden = true;
      missionLogList.hidden = false;
      missionLogList.innerHTML = state.missionLog
        .map(
          (entry) => `
            <li>
              <strong>Round ${entry.round}:</strong> ${entry.compound} (${entry.formula})<br />
              <span class="hint">${entry.successLine}</span><br />
              <small class="hint">${entry.spark}</small>
            </li>
          `
        )
        .join("");
    }

    function renderElements() {
      elementGridEl.innerHTML = state.displayedElements
        .map((el, index) => {
          const isSelected = state.selectedIndices.includes(index) ? " selected" : "";
          return `
            <button type="button" class="element-card${isSelected}" data-index="${index}">
              <span class="element-emoji" aria-hidden="true">${el.emoji}</span>
              <span class="element-name">${index + 1}. ${el.name} (${el.symbol})</span>
              <span class="element-detail">#${el.atomicNumber} Â· ${el.property}</span>
            </button>
          `;
        })
        .join("");
    }

    function updateSelectionHint() {
      if (!state.selectedIndices.length) {
        selectedElementsEl.textContent = "No elements selected yet.";
        return;
      }
      const picks = state.selectedIndices
        .map((index) => state.displayedElements[index])
        .map((el) => `${el.emoji} ${el.name}`);
      selectedElementsEl.textContent = `Selected: ${picks.join(" + ")}`;
    }

    function updateUIForRound() {
      roundEl.textContent = state.round;
      attemptsEl.textContent = state.attempts;
      promptEl.textContent = state.currentChallenge.prompt;
      focusEl.textContent = state.currentChallenge.focus;
      renderElements();
      updateSelectionHint();
    }

    function syncInputWithSelection() {
      comboInput.value = state.selectedIndices.map((index) => index + 1).join(" + ");
    }

    function toggleSelection(index) {
      const existing = state.selectedIndices.indexOf(index);
      if (existing >= 0) {
        state.selectedIndices.splice(existing, 1);
      } else {
        if (state.selectedIndices.length === 2) {
          state.selectedIndices.shift();
        }
        state.selectedIndices.push(index);
      }
      renderElements();
      updateSelectionHint();
      syncInputWithSelection();
    }

    function normalizeSelection(input) {
      return input
        .split(/\s|\+/)
        .map((part) => part.trim())
        .filter(Boolean);
    }

    function translateSelection(selection) {
      const ids = selection
        .map((value) => {
          const index = Number(value);
          if (Number.isNaN(index)) {
            return null;
          }
          const element = state.displayedElements[index - 1];
          return element ? element.id : null;
        })
        .filter(Boolean);
      return [...new Set(ids)];
    }

    function buildKey(ids) {
      return ids.slice().sort().join(",");
    }

    function awardPoints(attempts) {
      const base = 120;
      const penalty = (attempts - 1) * 25;
      return Math.max(40, base - penalty);
    }

    function randomSpark() {
      return careerSparks[Math.floor(Math.random() * careerSparks.length)];
    }

    function handleSubmit(event) {
      event.preventDefault();
      const raw = comboInput.value.trim();
      if (!raw) {
        feedbackBody.innerHTML = "<p>Please enter two element numbers.</p>";
        feedbackEl.innerHTML = "<h3>Feedback</h3><p>Please enter two element numbers.</p>";
        return;
      }
      state.attempts += 1;
      attemptsEl.textContent = state.attempts;
      const selection = normalizeSelection(raw);
      if (selection.length < 2) {
        feedbackBody.innerHTML = "<p>Enter at least two numbers separated by spaces or + signs.</p>";
        feedbackEl.innerHTML = "<h3>Feedback</h3><p>Enter at least two numbers separated by spaces or + signs.</p>";
        return;
      }
      const chosenIds = translateSelection(selection);
      if (chosenIds.length < 2) {
        feedbackBody.innerHTML = "<p>Make sure the numbers match the list above.</p>";
        feedbackEl.innerHTML = "<h3>Feedback</h3><p>Make sure the numbers match the list above.</p>";
        return;
      }
      const key = buildKey(chosenIds);
      const requiredKey = buildKey(state.currentChallenge.requiredElements);
      if (key === requiredKey) {
        const compound = knownCompounds[key];
        const spark = randomSpark();
        const points = awardPoints(state.attempts);
        state.score += points;
        scoreEl.textContent = state.score;
        feedbackBody.innerHTML = `
          <p class="celebrate">${state.currentChallenge.success}</p>
        feedbackEl.innerHTML = `
          <h3 class="celebrate">${state.currentChallenge.success}</h3>
          <p>You combined <strong>${compound.name}</strong> (${compound.formula}).</p>
          <p class="hint">Fun Fact: ${compound.funFact}</p>
          <p class="hint">Career Spark: ${spark}</p>
          <p>Points earned: ${points}</p>
        `;
        state.missionLog.unshift({
          round: state.round,
          compound: compound.name,
          formula: compound.formula,
          successLine: state.currentChallenge.success,
          spark
        });
        state.missionLog = state.missionLog.slice(0, 3);
        renderMissionLog();
        nextButton.disabled = false;
      } else if (knownCompounds[key]) {
        const compound = knownCompounds[key];
        feedbackBody.innerHTML = `
          <p class="hint">Close, but not quite.</p>
        feedbackEl.innerHTML = `
          <h3>Close, but not quite.</h3>
          <p>You formed <strong>${compound.name}</strong> (${compound.formula}), which is useful because ${compound.funFact}</p>
          <p class="hint">Hint: ${state.currentChallenge.focus}</p>
        `;
      } else {
        const chosenNames = chosenIds
          .map((id) => elements.find((el) => el.id === id)?.name || id)
          .join(" + ");
        feedbackBody.innerHTML = `
          <p class="hint">That combo fizzled.</p>
        feedbackEl.innerHTML = `
          <h3>That combo fizzled.</h3>
          <p>${chosenNames} did not meet the challenge. Some elements, like neon, barely bond at all!</p>
          <p class="hint">Hint: ${state.currentChallenge.focus}</p>
        `;
      }
    }

    comboForm.addEventListener("submit", handleSubmit);
    elementGridEl.addEventListener("click", (event) => {
      const card = event.target.closest(".element-card");
      if (!card) return;
      const index = Number(card.dataset.index);
      if (Number.isNaN(index)) return;
      toggleSelection(index);
    });
    nextButton.addEventListener("click", () => {
      if (!nextButton.disabled) {
        startRound();
      }
    });

    restartButton.addEventListener("click", () => {
      state.round = 0;
      state.score = 0;
      scoreEl.textContent = 0;
      state.missionLog = [];
      renderMissionLog();
      startRound();
    });

    renderMissionLog();
    startRound();
  </script>
</body>
</html>
